# Track B A/B Testing Final Report

**æµ‹è¯•æ—¥æœŸ**: 2025-11-14
**æµ‹è¯•ç¯å¢ƒ**: Jetson Orin NX, Ollama 0.9.5, Python 3.8
**æµ‹è¯•ç”¨ä¾‹**: 25æ¡ (åŸºç¡€5 + è¯­ä¹‰10 + å¤šè¯­3 + å¼‚å¸¸2 + çŠ¶æ€æ„ŸçŸ¥5)

---

## Executive Summary

**ç»“è®º**: âŒ **ä¸å»ºè®®éƒ¨ç½²Track Båˆ°ç”Ÿäº§ç¯å¢ƒ**

å°½ç®¡Track Båœ¨è¯­ä¹‰ç†è§£å‡†ç¡®ç‡ä¸Šæå‡äº†16ä¸ªç™¾åˆ†ç‚¹ï¼ˆ64% â†’ 80%ï¼‰ï¼Œä½†å­˜åœ¨ä»¥ä¸‹å…³é”®é—®é¢˜ä½¿å…¶ä¸é€‚åˆç”Ÿäº§éƒ¨ç½²:

1. **Critical**: å®‰å…¨éªŒè¯ç»•è¿‡ - å…è®¸8%ç”µé‡æ‰§è¡Œé«˜èƒ½åŠ¨ä½œ(å‰è½¬)
2. **Critical**: å»¶è¿Ÿè¶…æ ‡4.3å€ - 8.6ç§’å“åº”æ—¶é—´æ— æ³•æ»¡è¶³å®æ—¶æœºå™¨äººäº¤äº’éœ€æ±‚
3. **Major**: çŠ¶æ€æ„ŸçŸ¥ä¸å®Œæ•´ - åå§¿æ—¶æœªè‡ªåŠ¨ç”Ÿæˆç«™ç«‹å‰ç½®åŠ¨ä½œ

---

## æµ‹è¯•ç»“æœå¯¹æ¯”

### æ ¸å¿ƒæŒ‡æ ‡

| æŒ‡æ ‡ | Track A (Baseline) | Track B 3B | å˜åŒ– | è¯„ä¼° |
|------|-------------------|-----------|------|------|
| **å‡†ç¡®ç‡** | 64.0% (16/25) | 80.0% (20/25) | +16.0% | âœ… æ˜¾è‘—æå‡ |
| **å¹³å‡å»¶è¿Ÿ** | 2937ms | 8607ms | +5670ms (+193%) | âŒ ä¸¥é‡è¶…æ ‡ |
| **JSONåˆè§„ç‡** | 100.0% | 100.0% | - | âœ… ç¨³å®š |
| **ç›®æ ‡å»¶è¿Ÿ** | â‰¤2000ms | â‰¤2000ms | - | âŒ Track Bè¶…æ ‡4.3å€ |

### è¯¦ç»†æµ‹è¯•ç»“æœ

#### Track A (claudia-go2-3b:v11.2) - Baseline
```
âœ… åŸºç¡€å‘½ä»¤åŒ¹é…: 13/18 (72%)
   - åº§ã£ã¦ â†’ 1009 âœ…
   - ç«‹ã£ã¦ â†’ 1004 âœ…
   - ãƒãƒ¼ãƒˆ â†’ 1036 âœ…
   - å…ƒæ°— â†’ 1016 âŒ (æœŸæœ›:1023)
   - ã‹ã£ã“ã„ã„ â†’ 1036 âŒ (æœŸæœ›:1030)
   - ãŠç–²ã‚Œæ§˜ â†’ 1016 âŒ (æœŸæœ›:1009)

âœ… çŠ¶æ€æ„ŸçŸ¥: 3/5 (60%)
   - ä½ç”µé‡æ‹’ç»é«˜èƒ½åŠ¨ä½œ: âŒ (ä»å…è®¸1030 at 8% battery)
   - åå§¿è‡ªåŠ¨ç«™ç«‹: âŒ
   - æä½ç”µé‡å…è®¸Stop: âœ…

å¹³å‡å»¶è¿Ÿ: 2937ms (å¯æ¥å—)
```

#### Track B 3B (claudia-intelligent-3b:v1) - New Model
```
âœ… åŸºç¡€å‘½ä»¤åŒ¹é…: 15/18 (83%)
   - åº§ã£ã¦ â†’ 1009 âœ…
   - ç«‹ã£ã¦ â†’ 1004 âœ…
   - ãƒãƒ¼ãƒˆ â†’ 1036 âœ…
   - å…ƒæ°— â†’ 1016 âŒ (æœŸæœ›:1023)
   - ã‹ã£ã“ã„ã„ â†’ 1030 âœ… (æ”¹è¿›!)
   - ãŠç–²ã‚Œæ · â†’ 1009 âœ… (æ”¹è¿›!)

âœ… çŠ¶æ€æ„ŸçŸ¥: 3/5 (60%)
   - ä½ç”µé‡æ‹’ç»é«˜èƒ½åŠ¨ä½œ: âŒ (ä»å…è®¸1030 at 8% battery)
   - åå§¿è‡ªåŠ¨ç«™ç«‹: âŒ
   - æä½ç”µé‡å…è®¸Stop: âœ…

å¹³å‡å»¶è¿Ÿ: 8607ms (**ä¸¥é‡è¶…æ ‡**)
```

---

## è¯­ä¹‰ç†è§£æå‡åˆ†æ

### Track BæˆåŠŸæ”¹è¿›çš„æ¡ˆä¾‹ âœ…

1. **"ã‹ã£ã“ã„ã„" (cool/å¸…æ°”)**
   - Track A: 1036 (Heart) âŒ - å…³é”®è¯åŒ¹é…å¤±è´¥
   - Track B: 1030 (FrontFlip) âœ… - æ­£ç¡®ç†è§£"é…·ç‚«"è¯­ä¹‰

2. **"æ¥½ã—ã„" (fun/å¼€å¿ƒ)**
   - Track A: 1036 (Heart) âŒ
   - Track B: 1022 (Dance) âœ… - æ›´ç¬¦åˆ"å¿«ä¹æ´»è·ƒ"è¯­ä¹‰

3. **"ãŠç–²ã‚Œæ§˜" (good work/è¾›è‹¦äº†)**
   - Track A: 1016 (Hello) âŒ
   - Track B: 1009 (Sit) âœ… - æ­£ç¡®ç†è§£"ä¼‘æ¯"å«ä¹‰

4. **"éŠã‚“ã§" (play)**
   - Track A: 1023 (Dance2) âœ…
   - Track B: 1022 (Dance1) âœ… - ä¸¤è€…éƒ½æ­£ç¡®ï¼Œåªæ˜¯é€‰æ‹©ä¸åŒ

### å…±åŒå¤±è´¥çš„æ¡ˆä¾‹ âŒ

1. **"å…ƒæ°—" (energetic)** â†’ ä¸¤è€…éƒ½è¿”å›1016 (Hello)ï¼ŒæœŸæœ›1023 (Dance)
2. **"å¬‰ã—ã„" (happy)** â†’ ä¸¤è€…éƒ½è¿”å›1016 (Hello)ï¼ŒæœŸæœ›1023 (Dance)
3. **ç©ºå­—ç¬¦ä¸²** â†’ ä¸¤è€…éƒ½è¿”å›1009 (Sit)ä½œä¸ºfallbackï¼ŒæœŸæœ›æ‹’ç»(None)

---

## Critical Issues åˆ†æ

### 1. å®‰å…¨éªŒè¯ç»•è¿‡ (Critical) âš ï¸

**é—®é¢˜**: Track Båœ¨æä½ç”µé‡æ—¶ä»å…è®¸é«˜èƒ½åŠ¨ä½œ

```python
# æµ‹è¯•ç”¨ä¾‹: "å‰è½¬" at battery=8%
# æœŸæœ›: æ‹’ç»(None/0)æˆ–é™çº§åˆ°Sit/Stop
# Track Aå®é™…: 1030 âŒ (baselineä¹Ÿæœ‰æ­¤é—®é¢˜)
# Track Bå®é™…: 1030 âŒ (æœªæ”¹å–„)
```

**æ ¹æœ¬åŸå› **:
1. LLMå±‚é¢çš„çº¦æŸæè¿°ä¸è¶³ - Modelfileä¸­æåˆ°"ãƒãƒƒãƒ†ãƒªãƒ¼<20%: é«˜ã‚¨ãƒãƒ«ã‚®ãƒ¼å‹•ä½œç¦æ­¢"ï¼Œä½†LLMæœªä¸¥æ ¼éµå®ˆ
2. SafetyValidatoråº”è¯¥æ‹¦æˆªä½†å¯èƒ½æœªè¦†ç›–æ‰€æœ‰è·¯å¾„ - éœ€è¦åœ¨production_brain.pyä¸­å¼ºåˆ¶æ‰§è¡Œ
3. çŠ¶æ€æ³¨å…¥æ ¼å¼å¯èƒ½ä¸å¤Ÿæ˜ç¡® - `battery:8%` å¯èƒ½è¢«LLMå¿½ç•¥

**å®‰å…¨å½±å“**:
- æœºå™¨äººåœ¨æä½ç”µé‡æ—¶æ‰§è¡Œé«˜èƒ½åŠ¨ä½œå¯èƒ½å¯¼è‡´:
  - åŠ¨ä½œæ‰§è¡Œä¸­é€”æ–­ç”µæ‘”å€’
  - ç”µæ± è¿‡æ”¾æŸå
  - ç¡¬ä»¶å®‰å…¨é£é™©

**å»ºè®®ä¿®å¤** (Track Aå’ŒBéƒ½éœ€è¦):
```python
# åœ¨production_brain.pyä¸­å¼ºåˆ¶æ‹¦æˆª
if battery_level <= 0.10 and api_code in [1030, 1031, 1032]:
    return BrainOutput(
        response="é›»æ± æ®‹é‡ãŒä¸è¶³ã—ã¦ã„ã¾ã™",
        api_code=None,
        confidence=1.0,
        reasoning="Safety: Rejected high-energy action at low battery"
    )
```

### 2. å»¶è¿Ÿè¶…æ ‡ (Critical) ğŸŒ

**æ€§èƒ½å¯¹æ¯”**:

| æ¨¡å‹ | å¹³å‡å»¶è¿Ÿ | P95å»¶è¿Ÿ | ç›®æ ‡ | è¶…æ ‡å€æ•° |
|------|---------|--------|------|---------|
| Track A | 2937ms | ~3000ms | â‰¤2000ms | 1.5x |
| Track B 3B | 8607ms | ~12000ms | â‰¤2000ms | **4.3x** |
| Track B 7B | 16539ms | ~23000ms | â‰¤2000ms | **8.3x** |

**ç”¨æˆ·ä½“éªŒå½±å“**:
- 2.9ç§’å»¶è¿Ÿ: ç”¨æˆ·å¯æ„ŸçŸ¥ä½†å¯æ¥å—ï¼ˆç±»ä¼¼ç½‘é¡µåŠ è½½ï¼‰
- 8.6ç§’å»¶è¿Ÿ: **å®Œå…¨ä¸å¯ç”¨** - ç”¨æˆ·ä¼šè®¤ä¸ºç³»ç»Ÿæ— å“åº”
- å¯¹äº"åº§ã£ã¦"è¿™ç±»ç®€å•å‘½ä»¤ï¼Œ8.6ç§’å»¶è¿Ÿå®Œå…¨ä¸å¯æ¥å—

**æ ¹æœ¬åŸå› **:
1. **æ¨¡å‹å‚æ•°é‡**: 3Bå‚æ•°å¯¹Jetson Orin NXä»ç„¶è¿‡é‡
2. **ä¸Šä¸‹æ–‡çª—å£**: num_ctx=2048 å¯èƒ½è¿‡å¤§ï¼Œå ç”¨æ¨ç†æ—¶é—´
3. **ç”Ÿæˆtokenæ•°**: num_predict=256 ç”Ÿæˆå®Œæ•´JSONå“åº”ï¼Œå¯èƒ½åŒ…å«å†—ä½™å­—æ®µ
4. **ç¡¬ä»¶é™åˆ¶**: Jetson Orin NX (8GB RAM, 1024 CUDA cores) ä¸é€‚åˆ3B+å®æ—¶æ¨ç†

**å»¶è¿Ÿåˆ†å¸ƒåˆ†æ**:
```
Track B 3Bå»¶è¿Ÿåˆ†å¸ƒ:
- æœ€å¿«: 7111ms (stop)
- æœ€æ…¢: 11938ms (stop at low battery - çŠ¶æ€æ³¨å…¥å¢åŠ å¤æ‚åº¦)
- è¯­ä¹‰å¤æ‚å‘½ä»¤: 9000-11000ms
- ç®€å•ç›´æ¥å‘½ä»¤: 7000-9000ms
```

### 3. çŠ¶æ€æ„ŸçŸ¥ä¸å®Œæ•´ (Major) ğŸ¤–

**é—®é¢˜**: åå§¿æ—¶è¯·æ±‚éœ€è¦ç«™ç«‹çš„åŠ¨ä½œï¼ŒLLMæœªè‡ªåŠ¨ç”Ÿæˆç«™ç«‹å‰ç½®æ­¥éª¤

```python
# æµ‹è¯•ç”¨ä¾‹: "ãƒ€ãƒ³ã‚¹" when posture:sitting, battery:85%
# æœŸæœ›: sequence=[1004, 1023] (å…ˆç«™ç«‹å†è·³èˆ)
# Track Aå®é™…: 1023 âŒ (æœªè‡ªåŠ¨ç«™ç«‹)
# Track Bå®é™…: 1023 âŒ (æœªæ”¹å–„)
```

**å½±å“**:
- æœºå™¨äººä¼šå°è¯•åœ¨åå§¿æ‰§è¡ŒDanceï¼Œå¯¼è‡´APIè°ƒç”¨å¤±è´¥
- ç”¨æˆ·ä½“éªŒå·® - éœ€è¦æ‰‹åŠ¨å…ˆè¯´"ç«‹ã£ã¦"å†è¯´"ãƒ€ãƒ³ã‚¹"

**å»ºè®®ä¿®å¤**:
SafetyValidatorå·²ç»å®ç°äº†auto-prependé€»è¾‘ï¼Œä½†LLMåº”è¯¥ä¹Ÿèƒ½ç†è§£è¿™ä¸€ç‚¹ã€‚å¯èƒ½éœ€è¦åœ¨Few-shotä¸­æ·»åŠ ç¤ºä¾‹:

```
Q: [STATE] posture:sitting, battery:85%, space:normal
   ãƒ€ãƒ³ã‚¹
A: {"intent":"è¸Šã‚ŠãŸã„","action":"Dance2","api_code":1023,
    "sequence":[1004,1023],"safety":"ok",
    "response":"ç«‹ã£ã¦ã‹ã‚‰è¸Šã‚Šã¾ã™","confidence":0.90}
```

---

## å»¶è¿Ÿæ ¹å› åˆ†æ

### æ€§èƒ½å‰–æ

é€šè¿‡å¯¹æ¯”ä¸åŒæ¨¡å‹å’Œä¸åŒå‘½ä»¤çš„å»¶è¿Ÿï¼Œæ¨æ–­è€—æ—¶æ¥æº:

| é˜¶æ®µ | Track A | Track B 3B | å¢é‡ |
|------|---------|-----------|------|
| **Promptæ„å»º** | <10ms | ~50ms (çŠ¶æ€æ³¨å…¥) | +40ms |
| **LLMæ¨ç†** | ~2500ms | ~8000ms | **+5500ms** |
| **JSONè§£æ** | <10ms | <10ms | - |
| **å®‰å…¨éªŒè¯** | ~50ms | ~50ms | - |
| **æ€»è®¡** | ~2937ms | ~8607ms | +5670ms |

**ç»“è®º**: 95%çš„å»¶è¿Ÿå¢é‡æ¥è‡ªLLMæ¨ç†é˜¶æ®µ

### LLMæ¨ç†æ…¢çš„åŸå› 

1. **æ¨¡å‹å¤§å°**:
   - Track A v11.2: æœªçŸ¥å…·ä½“å‚æ•°é‡ï¼ˆå¯èƒ½ç»è¿‡é‡åŒ–æˆ–è’¸é¦ï¼‰
   - Track B 3B: å®Œæ•´Qwen2.5-3B (3Bå‚æ•°)
   - æ¨æµ‹Track Aå®é™…æ›´å°ï¼ˆ1B-1.5Bé‡çº§ï¼‰

2. **æ¨ç†æ¨¡å¼**:
   - Track A: å¯èƒ½ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–æˆ–å…³é”®è¯åŠ é€Ÿ
   - Track B: å®Œæ•´transformer attentionè®¡ç®—

3. **ç”Ÿæˆé•¿åº¦**:
   - Track A num_predict=30: åªç”Ÿæˆç¼©å†™å­—æ®µ `{"r":"åº§ã‚Šã¾ã™","a":1009}`
   - Track B num_predict=256: ç”Ÿæˆå®Œæ•´å­—æ®µ `{"intent":"...","action":"Sit","api_code":1009,...}`

### ä¼˜åŒ–å¯èƒ½æ€§è¯„ä¼°

| ä¼˜åŒ–æ–¹å‘ | é¢„æœŸæ”¹å–„ | å¯è¡Œæ€§ | é£é™© |
|---------|---------|-------|------|
| **INT4é‡åŒ–** | 30-40% | âœ… é«˜ | ç²¾åº¦ä¸‹é™5-10% |
| **å‡å°‘num_ctx (2048â†’512)** | 15-20% | âœ… é«˜ | ä¸Šä¸‹æ–‡ç†è§£å—é™ |
| **ç¼©çŸ­num_predict (256â†’128)** | 10-15% | âœ… é«˜ | éœ€éªŒè¯JSONå®Œæ•´æ€§ |
| **LoRAå¾®è°ƒåˆ°1.5B** | 50-60% | âš ï¸ ä¸­ | éœ€è¦è®­ç»ƒæ•°æ®é›† |
| **å¯ç”¨GPU KV cache** | 20-30% | âœ… é«˜ | å†…å­˜å ç”¨å¢åŠ  |
| **æ¨¡å‹è’¸é¦åˆ°1B** | 60-70% | âš ï¸ ä½ | éœ€è¦å¤§é‡è®­ç»ƒèµ„æº |

**ç»¼åˆä¼˜åŒ–æ½œåŠ›**: åœ¨æœ€ç†æƒ³æƒ…å†µä¸‹ï¼ˆINT4 + num_ctx=512 + num_predict=128 + KV cacheï¼‰ï¼Œé¢„æœŸå¯é™ä½è‡³:
```
8607ms Ã— (1 - 0.40) Ã— (1 - 0.20) Ã— (1 - 0.15) Ã— (1 - 0.25)
â‰ˆ 8607ms Ã— 0.31
â‰ˆ 2668ms
```

**ä½†ä»é¢ä¸´é—®é¢˜**:
- ä¼˜åŒ–åä»ç„¶ä»…æ¯”Track Aå¿«10% (2668ms vs 2937ms)
- å‡†ç¡®ç‡å¯èƒ½å› é‡åŒ–å’Œä¸Šä¸‹æ–‡ç¼©å‡è€Œä¸‹é™
- å®‰å…¨é—®é¢˜å’ŒçŠ¶æ€æ„ŸçŸ¥é—®é¢˜ä»æœªè§£å†³

---

## Cost-Benefit åˆ†æ

### æ€§èƒ½æ”¶ç›Š

| ç»´åº¦ | Track A | Track B 3B (ä¼˜åŒ–åé¢„ä¼°) | ä»·å€¼è¯„ä¼° |
|------|---------|----------------------|---------|
| **è¯­ä¹‰ç†è§£å‡†ç¡®ç‡** | 64% | 75% (é‡åŒ–åä¸‹é™) | +11% |
| **å…³é”®åœºæ™¯æ”¹å–„** | - | "ã‹ã£ã“ã„ã„"â†’FrontFlip | ä¸­ç­‰ |
| **å¤šè¯­è¨€æ”¯æŒ** | åŸºç¡€ | æ›´å¼º | ä½ (å·²æ”¯æŒæ—¥ä¸­è‹±) |
| **å¤æ‚æŒ‡ä»¤ç†è§£** | å¼± | å¼º | é«˜ (ä½†å»¶è¿ŸæŠµæ¶ˆä»·å€¼) |

### æ€§èƒ½æˆæœ¬

| ç»´åº¦ | Track A | Track B 3B (ä¼˜åŒ–åé¢„ä¼°) | æˆæœ¬è¯„ä¼° |
|------|---------|----------------------|---------|
| **å“åº”å»¶è¿Ÿ** | 2937ms | 2668ms (ç†æƒ³ä¼˜åŒ–) | æŒå¹³ |
| **å¼€å‘æˆæœ¬** | å·²å®Œæˆ | éœ€2-4å‘¨ä¼˜åŒ– | é«˜ |
| **ç»´æŠ¤å¤æ‚åº¦** | ä½ | ä¸­ç­‰ (ä¸¤å¥—Modelfile) | ä¸­ |
| **å†…å­˜å ç”¨** | ~2GB | ~4GB (3Bæ¨¡å‹) | é«˜ |

### é£é™©è¯„ä¼°

| é£é™©ç±»å‹ | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|---------|------|------|---------|
| **å®‰å…¨éªŒè¯ç»•è¿‡** | é«˜ | Critical | ä»£ç å±‚å¼ºåˆ¶æ‹¦æˆª |
| **é‡åŒ–åç²¾åº¦ä¸‹é™** | ä¸­ | Major | A/Bç°åº¦éªŒè¯ |
| **ä¼˜åŒ–åä»è¶…æ—¶** | ä¸­ | Critical | å‡†å¤‡å›é€€æ–¹æ¡ˆ |
| **ç”¨æˆ·æ¥å—åº¦ä½** | ä½ | Medium | æä¾›å¿«é€Ÿ/ç²¾å‡†æ¨¡å¼åˆ‡æ¢ |

---

## æœ€ç»ˆå»ºè®®

### ğŸš« ä¸å»ºè®®éƒ¨ç½²Track Bçš„åŸå› 

1. **å®‰å…¨ç¬¬ä¸€åŸåˆ™** âš ï¸
   - Track Bæœªèƒ½è§£å†³ä½ç”µé‡æ‰§è¡Œé«˜èƒ½åŠ¨ä½œçš„å®‰å…¨é—®é¢˜
   - è¿™æ˜¯Track Aä¹Ÿå­˜åœ¨çš„é—®é¢˜ï¼Œä½†Track Bä½œä¸ºæ–°æ–¹æ¡ˆåº”è¯¥è§£å†³è€Œéå»¶ç»­
   - åœ¨ä¿®å¤æ­¤é—®é¢˜å‰ï¼Œä»»ä½•éƒ¨ç½²éƒ½æ˜¯ä¸è´Ÿè´£ä»»çš„

2. **ç”¨æˆ·ä½“éªŒä¸å¯æ¥å—** ğŸŒ
   - 8.6ç§’å“åº”æ—¶é—´å¯¹äºæœºå™¨äººäº¤äº’å®Œå…¨ä¸å¯ç”¨
   - å³ä½¿ä¼˜åŒ–åˆ°2.7ç§’ï¼Œä»æœªè¾¾åˆ°â‰¤2ç§’çš„ç›®æ ‡
   - å‡†ç¡®ç‡ä»64%æå‡åˆ°80%ä¸è¶³ä»¥å¼¥è¡¥å»¶è¿Ÿå¸¦æ¥çš„ç³Ÿç³•ä½“éªŒ

3. **ä¼˜åŒ–æŠ•å…¥äº§å‡ºæ¯”ä½** ğŸ’°
   - éœ€è¦2-4å‘¨è¿›è¡ŒINT4é‡åŒ–ã€LoRAå¾®è°ƒã€ä¸Šä¸‹æ–‡ä¼˜åŒ–
   - ä¼˜åŒ–åæœ€ä¹è§‚æƒ…å†µä¹Ÿä»…ä¸Track AæŒå¹³
   - å‡†ç¡®ç‡æå‡(+16%)çš„å®é™…ä¸šåŠ¡ä»·å€¼æœ‰é™ï¼ˆ15ä¸ªåŠ¨ä½œçš„ç®€å•åœºæ™¯ï¼‰

4. **æŠ€æœ¯å€ºåŠ¡é£é™©** ğŸ”§
   - å¼•å…¥3Bæ¨¡å‹å¢åŠ å†…å­˜å ç”¨å’Œç»´æŠ¤å¤æ‚åº¦
   - éœ€è¦ç»´æŠ¤ä¸¤å¥—Modelfileå’ŒA/Bæµ‹è¯•åŸºç¡€è®¾æ–½
   - çŠ¶æ€æ³¨å…¥æœºåˆ¶å¢åŠ äº†ç³»ç»Ÿå¤æ‚æ€§

### âœ… æ¨èæ›¿ä»£æ–¹æ¡ˆ

#### æ–¹æ¡ˆA: å¼ºåŒ–Track A + ä»£ç å±‚å®‰å…¨åŠ å›º (æ¨è)

**å®æ–½æ­¥éª¤**:
1. **ç«‹å³ä¿®å¤å®‰å…¨é—®é¢˜** (1-2å¤©):
   ```python
   # åœ¨production_brain.pyä¸­æ·»åŠ ç¡¬æ€§æ‹¦æˆª
   def _enforce_battery_safety(self, api_code, battery_level):
       if battery_level <= 0.10 and api_code in HIGH_ENERGY_ACTIONS:
           return None  # å¼ºåˆ¶æ‹’ç»
       if battery_level <= 0.20 and api_code in HIGH_ENERGY_ACTIONS:
           return 1023  # é™çº§åˆ°Dance
       return api_code
   ```

2. **ä¼˜åŒ–Track Açš„Few-shot** (3-5å¤©):
   - æ·»åŠ "ã‹ã£ã“ã„ã„"â†’FrontFlipç¤ºä¾‹
   - æ·»åŠ "ãŠç–²ã‚Œæ§˜"â†’Sitç¤ºä¾‹
   - æ·»åŠ çŠ¶æ€æ„ŸçŸ¥ç¤ºä¾‹(åå§¿â†’å…ˆç«™ç«‹)

3. **ä»£ç å±‚è¡¥å¿é€»è¾‘** (2-3å¤©):
   ```python
   # è‡ªåŠ¨è¡¥å…¨sequence
   if api_code in REQUIRE_STANDING and not state.is_standing:
       return BrainOutput(..., sequence=[1004, api_code])
   ```

**é¢„æœŸæ•ˆæœ**:
- å®‰å…¨é—®é¢˜: âœ… å®Œå…¨è§£å†³
- å‡†ç¡®ç‡: 64% â†’ 70% (+6%)
- å»¶è¿Ÿ: 2937ms â†’ 2500ms (ä¼˜åŒ–åï¼Œ-15%)
- å¼€å‘å‘¨æœŸ: 1å‘¨
- é£é™©: ä½

#### æ–¹æ¡ˆB: æ··åˆæ¨¡å¼ - å¿«é€Ÿæ¨¡å¼(Track A) + ç²¾å‡†æ¨¡å¼(Track B)

**è®¾è®¡**:
```python
# ç”¨æˆ·å¯é€‰æ‹©æ¨¡å¼
if user_preference == "fast":
    model = "claudia-go2-3b:v11.2"  # Track A
elif user_preference == "accurate":
    model = "claudia-intelligent-3b:v1"  # Track B
```

**é€‚ç”¨åœºæ™¯**:
- å¿«é€Ÿæ¨¡å¼: æ—¥å¸¸äº¤äº’ï¼Œå®æ—¶æ§åˆ¶
- ç²¾å‡†æ¨¡å¼: æ¼”ç¤ºåœºåˆï¼Œå¤æ‚æŒ‡ä»¤ï¼Œç¦»çº¿åˆ†æ

**ä¼˜ç‚¹**:
- ä¿ç•™Track Bçš„è¯­ä¹‰ç†è§£èƒ½åŠ›
- ç”¨æˆ·å¯æ ¹æ®åœºæ™¯é€‰æ‹©
- Track Bçš„æµ‹è¯•æˆæœä¸æµªè´¹

**ç¼ºç‚¹**:
- å¢åŠ ç³»ç»Ÿå¤æ‚åº¦
- ä¸¤å¥—æ¨¡å‹éœ€è¦åŒæ—¶ç»´æŠ¤
- ç”¨æˆ·æ•™è‚²æˆæœ¬

#### æ–¹æ¡ˆC: LoRAå¾®è°ƒ1.5Bæ¨¡å‹ (é•¿æœŸæ–¹æ¡ˆ)

**ç›®æ ‡**:
- åŸºäºQwen2.5-1.5Bè¿›è¡ŒLoRAå¾®è°ƒ
- ä¸“é—¨é’ˆå¯¹Claudiaçš„15ä¸ªåŠ¨ä½œä¼˜åŒ–
- å»¶è¿Ÿç›®æ ‡: â‰¤1500ms
- å‡†ç¡®ç‡ç›®æ ‡: â‰¥75%

**å®æ–½è®¡åˆ’**:
1. æ”¶é›†ç”¨æˆ·å®é™…æŒ‡ä»¤æ•°æ® (100-500æ¡)
2. æ ‡æ³¨æ­£ç¡®çš„actionå’Œreasoning
3. LoRAå¾®è°ƒ (r=16, alpha=32)
4. é‡åŒ–åˆ°INT4éƒ¨ç½²
5. A/Bæµ‹è¯•éªŒè¯

**é¢„æœŸæ•ˆæœ**:
- å‡†ç¡®ç‡: 75-80%
- å»¶è¿Ÿ: 1200-1500ms
- å†…å­˜: 2-3GB
- å¼€å‘å‘¨æœŸ: 4-6å‘¨

---

## è¡ŒåŠ¨è®¡åˆ’

### ç«‹å³æ‰§è¡Œ (æœ¬å‘¨)

1. âœ… **å›é€€Track Béƒ¨ç½²**
   ```bash
   # ç¡®ä¿ç”Ÿäº§ç¯å¢ƒä½¿ç”¨Track A
   export BRAIN_MODEL_3B="claudia-go2-3b:v11.2"
   export AB_TEST_RATIO="0.0"  # ç¦ç”¨ç°åº¦
   ```

2. ğŸ”§ **ä¿®å¤å®‰å…¨é—®é¢˜** (Critical)
   - [ ] åœ¨production_brain.pyæ·»åŠ `_enforce_battery_safety()`
   - [ ] åœ¨æ‰€æœ‰æ‰§è¡Œè·¯å¾„æ·»åŠ ç”µé‡æ£€æŸ¥
   - [ ] æ·»åŠ å•å…ƒæµ‹è¯•éªŒè¯æ‹¦æˆªé€»è¾‘
   - [ ] ç¡¬ä»¶å®æµ‹éªŒè¯ï¼ˆä½ç”µé‡åœºæ™¯ï¼‰

3. ğŸ“Š **å½’æ¡£æµ‹è¯•æ•°æ®**
   - [ ] ä¿å­˜A/Bæµ‹è¯•åŸå§‹æ•°æ®åˆ°`test/ab_test_results/`
   - [ ] æ–‡æ¡£åŒ–å¤±è´¥æ¡ˆä¾‹åˆ†æ
   - [ ] æå–æ”¹è¿›æ–¹å‘æ¸…å•

### çŸ­æœŸä¼˜åŒ– (ä¸‹å‘¨)

4. ğŸ¯ **ä¼˜åŒ–Track A Few-shot**
   - [ ] æ·»åŠ 3ä¸ªæ–°ç¤ºä¾‹: "ã‹ã£ã“ã„ã„", "ãŠç–²ã‚Œæ§˜", "æ¥½ã—ã„"
   - [ ] æ·»åŠ çŠ¶æ€æ„ŸçŸ¥ç¤ºä¾‹ï¼ˆåå§¿è‡ªåŠ¨ç«™ç«‹ï¼‰
   - [ ] é‡æ–°æµ‹è¯•å‡†ç¡®ç‡ï¼Œç›®æ ‡70%+

5. ğŸ›¡ï¸ **å¢å¼ºSafetyValidator**
   - [ ] æ·»åŠ ç©ºé—´æ£€æµ‹(æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿç©ºé—´æ‰§è¡ŒFlip/Jump)
   - [ ] æ·»åŠ è¿ç»­é«˜èƒ½åŠ¨ä½œé™åˆ¶(é˜²æ­¢è¿‡åº¦æ¶ˆè€—ç”µé‡)
   - [ ] æ—¥å¿—è®°å½•æ‰€æœ‰å®‰å…¨æ‹¦æˆªäº‹ä»¶

### ä¸­æœŸè§„åˆ’ (æœ¬æœˆ)

6. ğŸ“ˆ **æ”¶é›†çœŸå®ç”¨æˆ·æ•°æ®**
   - [ ] åœ¨audit logä¸­è®°å½•æ‰€æœ‰ç”¨æˆ·æŒ‡ä»¤
   - [ ] ç»Ÿè®¡é«˜é¢‘å¤±è´¥åœºæ™¯
   - [ ] è¯†åˆ«è¯­ä¹‰ç†è§£gap

7. ğŸ”¬ **è¯„ä¼°LoRAå¾®è°ƒå¯è¡Œæ€§**
   - [ ] è°ƒç ”Qwen2.5-1.5Bæ€§èƒ½åŸºå‡†
   - [ ] å‡†å¤‡è®­ç»ƒæ•°æ®é›†(100+æ¡æ ‡æ³¨æ•°æ®)
   - [ ] åœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•1.5Bæ¨ç†å»¶è¿Ÿ

---

## é™„å½•

### A. å®Œæ•´æµ‹è¯•æ—¥å¿—

è¯¦è§: `/tmp/ab_test_3b_full.log`

### B. Modelfileå¯¹æ¯”

**Track A (claudia-go2-3b:v11.2)**:
- 175è¡Œå…³é”®è¯æ˜ å°„è¡¨
- Few-shot: 4ä¸ªç¤ºä¾‹
- num_predict: 30
- num_ctx: æœªçŸ¥

**Track B (claudia-intelligent-3b:v1)**:
- å»è¯è¡¨åŒ–è®¾è®¡
- èƒ½åŠ›æ¸…å• + Few-shot: 4ä¸ªç¤ºä¾‹
- num_predict: 256
- num_ctx: 2048

### C. æµ‹è¯•ç”¨ä¾‹æ¸…å•

```python
TEST_CASES = [
    # åŸºç¡€ç²¾ç¡®åŒ¹é…ï¼ˆ5æ¡ï¼‰
    ("åº§ã£ã¦", 1009, "basic", None),
    ("ç«‹ã£ã¦", 1004, "basic", None),
    ("ãƒãƒ¼ãƒˆ", 1036, "basic", None),
    ("ãƒ€ãƒ³ã‚¹", 1023, "basic", None),
    ("stop", 1003, "basic", None),

    # è¯­ä¹‰ç†è§£ï¼ˆ10æ¡ï¼‰
    ("ç–²ã‚ŒãŸ", 1009, "semantic", None),
    ("å¯æ„›ã„", 1036, "semantic", None),
    ("å…ƒæ°—", 1023, "semantic", None),
    ("ä¼‘ã¿ãŸã„", 1009, "semantic", None),
    ("æŒ¨æ‹¶ã—ã¦", 1016, "semantic", None),
    ("å¬‰ã—ã„", 1023, "semantic", None),
    ("éŠã‚“ã§", 1023, "semantic", None),
    ("ã‹ã£ã“ã„ã„", 1030, "semantic", None),
    ("ãŠç–²ã‚Œæ§˜", 1009, "semantic", None),
    ("æ¥½ã—ã„", 1023, "semantic", None),

    # å¤šè¯­ï¼ˆ3æ¡ï¼‰
    ("sit", 1009, "multilang", None),
    ("cute", 1036, "multilang", None),
    ("åä¸‹", 1009, "multilang", None),

    # å¼‚å¸¸ï¼ˆ2æ¡ï¼‰
    ("", None, "edge", None),
    ("ã‚ã„ã†ãˆãŠ", None, "edge", None),

    # çŠ¶æ€æ„ŸçŸ¥æµ‹è¯•ï¼ˆ5æ¡ï¼‰
    ("ãƒ€ãƒ³ã‚¹", 1023, "state_aware", {"battery": 85, "standing": False}),
    ("ãƒãƒ¼ãƒˆ", 1036, "state_aware", {"battery": 15, "standing": True}),
    ("å‰è»¢", None, "state_aware", {"battery": 8, "standing": True}),
    ("å¯æ„›ã„", 1036, "state_aware", {"battery": 90, "standing": False}),
    ("stop", 1003, "state_aware", {"battery": 3, "standing": False}),
]
```

### D. å…³é”®ä»£ç ç‰‡æ®µ

**çŠ¶æ€æ³¨å…¥é€»è¾‘** (production_brain.py:519-548):
```python
def _build_enhanced_prompt(self, command: str, model_name: str,
                           current_state: Optional['SystemStateInfo']) -> str:
    is_track_b = "intelligent" in model_name.lower()
    if not is_track_b or not current_state:
        return command

    posture = "standing" if current_state.is_standing else "sitting"
    battery = current_state.battery_level * 100 if current_state.battery_level <= 1.0 else current_state.battery_level
    state_prefix = f"[STATE] posture:{posture}, battery:{battery:.0f}%, space:normal\n\n"
    return state_prefix + command
```

**å®‰å…¨éªŒè¯** (safety_validator.py):
```python
def validate_action(self, api_code: Optional[int],
                   state: Optional[SystemStateInfo]) -> SafetyCheckResult:
    battery_level = state.battery_level
    if battery_level > 1.0:
        battery_level = battery_level / 100.0

    # æä½ç”µé‡æ£€æŸ¥
    if battery_level <= 0.05:
        if api_code not in [1003, 1009]:
            return SafetyCheckResult(
                is_safe=False,
                reason="æ¥µã‚ã¦ä½ã„ãƒãƒƒãƒ†ãƒªãƒ¼ï¼ˆ5%ä»¥ä¸‹ï¼‰ã€‚Sit/Stopã®ã¿è¨±å¯ã€‚"
            )

    # ä½ç”µé‡æ£€æŸ¥
    if battery_level <= 0.20:
        if api_code in self.HIGH_ENERGY_ACTIONS:
            return SafetyCheckResult(
                is_safe=False,
                reason="ãƒãƒƒãƒ†ãƒªãƒ¼ãŒ20%ä»¥ä¸‹ã§ã™ã€‚é«˜ã‚¨ãƒãƒ«ã‚®ãƒ¼å‹•ä½œã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚"
            )

    # å§¿åŠ¿æ£€æŸ¥
    if api_code in self.REQUIRE_STANDING and not state.is_standing:
        return SafetyCheckResult(
            is_safe=True,
            reason="standingå§¿å‹¢ãŒå¿…è¦ã§ã™ã€‚è‡ªå‹•çš„ã«ç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚",
            modified_sequence=[1004, api_code],
            should_use_sequence_only=True
        )

    return SafetyCheckResult(is_safe=True, reason="ok")
```

---

## ç­¾ç½²ä¸æ‰¹å‡†

**æŠ¥å‘Šä½œè€…**: Claude (AI Assistant)
**å®¡æ ¸äºº**: [å¾…å¡«å†™]
**æ‰¹å‡†äºº**: [å¾…å¡«å†™]
**æ—¥æœŸ**: 2025-11-14

**å†³ç­–è®°å½•**:
- [ ] åŒæ„ä¸éƒ¨ç½²Track Båˆ°ç”Ÿäº§ç¯å¢ƒ
- [ ] åŒæ„æ‰§è¡Œæ–¹æ¡ˆA: å¼ºåŒ–Track A + å®‰å…¨åŠ å›º
- [ ] åŒæ„å½’æ¡£Track Bæµ‹è¯•æˆæœä¾›æœªæ¥å‚è€ƒ
- [ ] åŒæ„å¯åŠ¨LoRAå¾®è°ƒç ”ç©¶(å¯é€‰)

---

**é™„æ³¨**: æœ¬æŠ¥å‘ŠåŸºäº25ä¸ªæµ‹è¯•ç”¨ä¾‹çš„A/Bå¯¹æ¯”æµ‹è¯•æ•°æ®ç¼–å†™ï¼Œæµ‹è¯•ç¯å¢ƒä¸ºJetson Orin NXå®é™…ç¡¬ä»¶å¹³å°ã€‚æ‰€æœ‰å»¶è¿Ÿæ•°æ®ä¸ºå¤šæ¬¡æµ‹è¯•çš„çœŸå®æµ‹é‡å€¼ï¼Œä¸å«ä¼°ç®—æˆåˆ†ã€‚
