---
description: 
globs: 
alwaysApply: true
---
# Claudiaæœºå™¨äººé¡¹ç›®ç®¡ç†è§„åˆ™

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

- **é¡¹ç›®æ•´æ´ä¼˜å…ˆ**: æ¯æ¬¡æ“ä½œåç«‹å³æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œå¤±è´¥æ–‡ä»¶
- **æ—¶é—´æ ‡å‡†åŒ–**: æ‰€æœ‰æ—¶é—´ç›¸å…³æ“ä½œä½¿ç”¨æ ‡å‡†åŒ–å‘½ä»¤å’Œæ ¼å¼
- **æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†**: æ˜ç¡®æ–‡ä»¶åˆ›å»ºã€ä½¿ç”¨ã€å½’æ¡£ã€åˆ é™¤æµç¨‹
- **å¯è¿½æº¯æ€§**: æ‰€æœ‰æ“ä½œéƒ½æœ‰æ¸…æ™°çš„æ—¶é—´æˆ³å’Œæ¥æºè®°å½•

## ğŸ“ æ–‡ä»¶ç®¡ç†è§„èŒƒ

### æ–‡ä»¶ç”Ÿæˆè§„åˆ™

#### 1. è„šæœ¬æ–‡ä»¶ç”Ÿæˆ
```bash
# âœ… æ­£ç¡®çš„è„šæœ¬åˆ›å»ºæµç¨‹
SCRIPT_NAME="validate_environment.sh"
SCRIPT_PATH="scripts/setup/${SCRIPT_NAME}"
TIMESTAMP=$(date '+%Y%m%d_%H%M%S')

# åˆ›å»ºè„šæœ¬å‰æ£€æŸ¥æ˜¯å¦å­˜åœ¨
if [ -f "$SCRIPT_PATH" ]; then
    mv "$SCRIPT_PATH" "$SCRIPT_PATH.backup_${TIMESTAMP}"
    echo "å¤‡ä»½ç°æœ‰è„šæœ¬: $SCRIPT_PATH.backup_${TIMESTAMP}"
fi

# åˆ›å»ºæ–°è„šæœ¬
cat > "$SCRIPT_PATH" << 'EOF'
#!/bin/bash
# Generated: $(date '+%Y-%m-%d %H:%M:%S')
# Purpose: [å…·ä½“ç”¨é€”]
EOF

chmod +x "$SCRIPT_PATH"
echo "âœ… è„šæœ¬åˆ›å»ºå®Œæˆ: $SCRIPT_PATH"
```

#### 2. é…ç½®æ–‡ä»¶ç”Ÿæˆ
```bash
# âœ… é…ç½®æ–‡ä»¶æ ‡å‡†æ ¼å¼
CONFIG_FILE="config/claudia_config.yaml"
mkdir -p "$(dirname "$CONFIG_FILE")"

cat > "$CONFIG_FILE" << EOF
# Claudia Robot Configuration
# Generated: $(date '+%Y-%m-%d %H:%M:%S %Z')
# Platform: $(uname -m) $(lsb_release -d | cut -f2)
# Version: $(git rev-parse --short HEAD 2>/dev/null || echo "unknown")

# é…ç½®å†…å®¹...
EOF
```

#### 3. æ—¥å¿—æ–‡ä»¶å‘½å
```bash
# âœ… æ ‡å‡†æ—¥å¿—æ–‡ä»¶å‘½å
LOG_DIR="logs/$(date '+%Y%m')"
mkdir -p "$LOG_DIR"
LOG_FILE="$LOG_DIR/$(date '+%Y%m%d_%H%M%S')_${OPERATION_NAME}.log"

# ç¤ºä¾‹ï¼šlogs/202406/20240626_134522_ros2_validation.log
```

### ä¸´æ—¶æ–‡ä»¶ç®¡ç†

#### 1. ä¸´æ—¶æ–‡ä»¶åˆ›å»º
```bash
# âœ… ä½¿ç”¨ç³»ç»Ÿä¸´æ—¶ç›®å½•
TEMP_DIR=$(mktemp -d -t claudia.XXXXXX)
TEMP_FILE=$(mktemp -t claudia_operation.XXXXXX)

# è‡ªåŠ¨æ¸…ç†å‡½æ•°
cleanup_temp() {
    [ -d "$TEMP_DIR" ] && rm -rf "$TEMP_DIR"
    [ -f "$TEMP_FILE" ] && rm -f "$TEMP_FILE"
    echo "ğŸ§¹ ä¸´æ—¶æ–‡ä»¶å·²æ¸…ç†"
}

# è®¾ç½®é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†
trap cleanup_temp EXIT
```

#### 2. ä¸‹è½½æ–‡ä»¶ç®¡ç†
```bash
# âœ… ä¸‹è½½æ–‡ä»¶æ ‡å‡†ä½ç½®
DOWNLOAD_DIR="tmp/downloads/$(date '+%Y%m%d')"
mkdir -p "$DOWNLOAD_DIR"

# ä¸‹è½½å®ŒæˆåéªŒè¯å¹¶ç§»åŠ¨åˆ°æœ€ç»ˆä½ç½®
download_and_verify() {
    local url="$1"
    local final_path="$2"
    local temp_path="$DOWNLOAD_DIR/$(basename "$url")"
    
    wget "$url" -O "$temp_path"
    
    # éªŒè¯ä¸‹è½½
    if [ -f "$temp_path" ] && [ -s "$temp_path" ]; then
        mv "$temp_path" "$final_path"
        echo "âœ… ä¸‹è½½å®Œæˆ: $final_path"
    else
        rm -f "$temp_path"
        echo "âŒ ä¸‹è½½å¤±è´¥: $url"
        return 1
    fi
}
```

## ğŸ§¹ æ¸…ç†è§„èŒƒ

### è‡ªåŠ¨æ¸…ç†è§¦å‘å™¨

#### 1. æ“ä½œå®Œæˆåæ¸…ç†
```bash
# æ¯ä¸ªä¸»è¦æ“ä½œåçš„æ ‡å‡†æ¸…ç†
standard_cleanup() {
    local operation_name="$1"
    echo "ğŸ§¹ å¼€å§‹æ¸…ç† $operation_name ç›¸å…³æ–‡ä»¶..."
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    find /tmp -name "claudia*" -mtime +1 -type f -delete 2>/dev/null
    
    # æ¸…ç†ç©ºç›®å½•
    find tmp/ -type d -empty -delete 2>/dev/null
    
    # æ¸…ç†å¤±è´¥çš„ä¸‹è½½
    find tmp/downloads/ -name "*.tmp" -delete 2>/dev/null
    find tmp/downloads/ -size 0 -delete 2>/dev/null
    
    # æ¸…ç†è¿‡æœŸæ—¥å¿—ï¼ˆä¿ç•™æœ€è¿‘30å¤©ï¼‰
    find logs/ -name "*.log" -mtime +30 -delete 2>/dev/null
    
    echo "âœ… $operation_name æ¸…ç†å®Œæˆ"
}
```

#### 2. å¤±è´¥æ“ä½œæ¸…ç†
```bash
# æ“ä½œå¤±è´¥æ—¶çš„æ¸…ç†
cleanup_on_failure() {
    local operation_name="$1"
    local failure_reason="$2"
    
    echo "âŒ $operation_name å¤±è´¥: $failure_reason"
    
    # è®°å½•å¤±è´¥ä¿¡æ¯
    FAILURE_LOG="logs/failures/$(date '+%Y%m%d_%H%M%S')_${operation_name}_failure.log"
    mkdir -p "$(dirname "$FAILURE_LOG")"
    
    cat > "$FAILURE_LOG" << EOF
Operation: $operation_name
Time: $(date '+%Y-%m-%d %H:%M:%S %Z')
Reason: $failure_reason
Platform: $(uname -a)
Working Directory: $(pwd)
Git Status: $(git status --porcelain 2>/dev/null || echo "Not a git repository")
Disk Space: $(df -h .)
Memory: $(free -h)
EOF
    
    # æ¸…ç†å¤±è´¥äº§ç”Ÿçš„æ–‡ä»¶
    standard_cleanup "$operation_name"
    
    echo "ğŸ—‚ï¸ å¤±è´¥ä¿¡æ¯å·²è®°å½•: $FAILURE_LOG"
}
```

### é¡¹ç›®ç»´æŠ¤è„šæœ¬

#### 1. æ—¥å¸¸æ¸…ç†è„šæœ¬
```bash
# scripts/maintenance/daily_cleanup.sh
#!/bin/bash
set -e

CLEANUP_DATE=$(date '+%Y-%m-%d %H:%M:%S')
echo "ğŸ§¹ å¼€å§‹æ—¥å¸¸æ¸…ç† - $CLEANUP_DATE"

# æ¸…ç†æ„å»ºä¸´æ—¶æ–‡ä»¶
echo "æ¸…ç†æ„å»ºæ–‡ä»¶..."
find . -name "*.pyc" -delete
find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
find . -name ".pytest_cache" -type d -exec rm -rf {} + 2>/dev/null || true

# æ¸…ç†ç¼–è¾‘å™¨ä¸´æ—¶æ–‡ä»¶
echo "æ¸…ç†ç¼–è¾‘å™¨ä¸´æ—¶æ–‡ä»¶..."
find . -name "*~" -delete
find . -name ".#*" -delete
find . -name "#*#" -delete

# æ¸…ç†ç©ºç›®å½•
echo "æ¸…ç†ç©ºç›®å½•..."
find . -type d -empty -not -path "./.git*" -delete 2>/dev/null || true

# æ¸…ç†è¿‡æœŸæ—¥å¿—
echo "æ¸…ç†è¿‡æœŸæ—¥å¿—..."
find logs/ -name "*.log" -mtime +30 -delete 2>/dev/null || true

# å‹ç¼©æ—§æ—¥å¿—
echo "å‹ç¼©æ—§æ—¥å¿—..."
find logs/ -name "*.log" -mtime +7 -exec gzip {} \; 2>/dev/null || true

echo "âœ… æ—¥å¸¸æ¸…ç†å®Œæˆ - $(date '+%Y-%m-%d %H:%M:%S')"
```

## â° æ—¶é—´å¤„ç†è§„èŒƒ

### æ ‡å‡†æ—¶é—´å‘½ä»¤

#### 1. æ—¶é—´æˆ³ç”Ÿæˆ
```bash
# âœ… æ ‡å‡†æ—¶é—´æˆ³æ ¼å¼
TIMESTAMP_ISO=$(date '+%Y-%m-%dT%H:%M:%S%z')     # 2024-06-26T13:45:22+0800
TIMESTAMP_FILE=$(date '+%Y%m%d_%H%M%S')          # 20240626_134522
TIMESTAMP_LOG=$(date '+%Y-%m-%d %H:%M:%S %Z')    # 2024-06-26 13:45:22 CST
TIMESTAMP_SIMPLE=$(date '+%Y%m%d')               # 20240626

echo "æ“ä½œæ—¶é—´: $TIMESTAMP_LOG"
echo "æ–‡ä»¶åç¼€: $TIMESTAMP_FILE"
```

#### 2. æ—¶é—´éªŒè¯
```bash
# âœ… éªŒè¯æ—¶é—´ç›¸å…³æ“ä½œ
verify_time_sensitive_operation() {
    local start_time=$(date '+%s')
    local operation_name="$1"
    
    echo "â° å¼€å§‹ $operation_name - $(date '+%Y-%m-%d %H:%M:%S')"
    
    # æ‰§è¡Œæ“ä½œ...
    
    local end_time=$(date '+%s')
    local duration=$((end_time - start_time))
    
    echo "âœ… å®Œæˆ $operation_name - è€—æ—¶ ${duration}ç§’"
    
    # è®°å½•åˆ°æ—¶é—´æ—¥å¿—
    echo "$(date '+%Y-%m-%d %H:%M:%S') | $operation_name | ${duration}s" >> logs/timing.log
}
```

#### 3. è¶…æ—¶å¤„ç†
```bash
# âœ… æ“ä½œè¶…æ—¶æ§åˆ¶
execute_with_timeout() {
    local timeout_seconds="$1"
    local operation_name="$2"
    shift 2
    
    echo "â° æ‰§è¡Œ $operation_name (è¶…æ—¶: ${timeout_seconds}ç§’)"
    
    if timeout "$timeout_seconds" "$@"; then
        echo "âœ… $operation_name åœ¨æ—¶é™å†…å®Œæˆ"
        return 0
    else
        echo "â° $operation_name è¶…æ—¶ï¼Œæ‰§è¡Œæ¸…ç†..."
        cleanup_on_failure "$operation_name" "æ“ä½œè¶…æ—¶(${timeout_seconds}ç§’)"
        return 1
    fi
}
```

## ğŸ“Š çŠ¶æ€ç›‘æ§

### ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
```bash
# âœ… ç³»ç»Ÿèµ„æºç›‘æ§
check_system_status() {
    echo "ğŸ” ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ - $(date '+%Y-%m-%d %H:%M:%S')"
    
    # ç£ç›˜ç©ºé—´æ£€æŸ¥
    local disk_usage=$(df . | tail -1 | awk '{print $5}' | sed 's/%//')
    if [ "$disk_usage" -gt 90 ]; then
        echo "âš ï¸ ç£ç›˜ç©ºé—´ä¸è¶³: ${disk_usage}%"
        echo "å¼€å§‹æ¸…ç†..."
        standard_cleanup "disk_space_emergency"
    fi
    
    # å†…å­˜æ£€æŸ¥
    local mem_usage=$(free | grep Mem | awk '{printf "%.0f", $3/$2 * 100.0}')
    if [ "$mem_usage" -gt 90 ]; then
        echo "âš ï¸ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${mem_usage}%"
    fi
    
    # æ£€æŸ¥å…³é”®è¿›ç¨‹
    if ! pgrep -f "ros" > /dev/null 2>&1; then
        echo "â„¹ï¸ ROS2è¿›ç¨‹æœªè¿è¡Œ"
    fi
    
    echo "ğŸ’¾ ç£ç›˜: ${disk_usage}% | ğŸ§  å†…å­˜: ${mem_usage}%"
}
```

### GitçŠ¶æ€ç®¡ç†
```bash
# âœ… Gitä»“åº“çŠ¶æ€æ£€æŸ¥
check_git_status() {
    if ! git rev-parse --git-dir > /dev/null 2>&1; then
        echo "â„¹ï¸ ä¸åœ¨Gitä»“åº“ä¸­"
        return 0
    fi
    
    echo "ğŸ“‹ GitçŠ¶æ€æ£€æŸ¥ - $(date '+%Y-%m-%d %H:%M:%S')"
    
    # æ£€æŸ¥æœªæäº¤æ›´æ”¹
    if ! git diff --quiet; then
        echo "âš ï¸ æœ‰æœªæäº¤çš„æ›´æ”¹"
        git status --porcelain
    fi
    
    # æ£€æŸ¥æœªè·Ÿè¸ªæ–‡ä»¶
    local untracked=$(git ls-files --others --exclude-standard | wc -l)
    if [ "$untracked" -gt 0 ]; then
        echo "â„¹ï¸ æœ‰ $untracked ä¸ªæœªè·Ÿè¸ªæ–‡ä»¶"
    fi
    
    # æ˜¾ç¤ºå½“å‰åˆ†æ”¯å’Œæäº¤
    echo "ğŸŒ¿ åˆ†æ”¯: $(git branch --show-current)"
    echo "ğŸ“ æœ€æ–°æäº¤: $(git log -1 --oneline)"
}
```

## ğŸ”§ å®ç”¨å·¥å…·å‡½æ•°

### é”™è¯¯å¤„ç†
```bash
# âœ… æ ‡å‡†é”™è¯¯å¤„ç†
handle_error() {
    local exit_code=$?
    local line_number=$1
    local command="$2"
    
    if [ $exit_code -ne 0 ]; then
        echo "âŒ é”™è¯¯å‘ç”Ÿåœ¨ç¬¬ $line_number è¡Œ: $command"
        echo "é€€å‡ºç : $exit_code"
        echo "æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        
        # è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯
        ERROR_LOG="logs/errors/$(date '+%Y%m%d_%H%M%S')_error.log"
        mkdir -p "$(dirname "$ERROR_LOG")"
        
        {
            echo "Error Details:"
            echo "Time: $(date '+%Y-%m-%d %H:%M:%S %Z')"
            echo "Line: $line_number"
            echo "Command: $command"
            echo "Exit Code: $exit_code"
            echo "Working Directory: $(pwd)"
            echo "Environment:"
            env | grep -E "(ROS|CYCLONE|UNITREE)" || true
        } > "$ERROR_LOG"
        
        cleanup_on_failure "unknown_operation" "å‘½ä»¤æ‰§è¡Œå¤±è´¥"
        exit $exit_code
    fi
}

# è®¾ç½®é”™è¯¯å¤„ç†
set -e
trap 'handle_error $LINENO "$BASH_COMMAND"' ERR
```

### è¿›åº¦æ˜¾ç¤º
```bash
# âœ… è¿›åº¦æ˜¾ç¤ºå‡½æ•°
show_progress() {
    local current="$1"
    local total="$2"
    local operation="$3"
    
    local percentage=$((current * 100 / total))
    local progress_bar=""
    local completed=$((percentage / 2))
    
    for ((i=1; i<=50; i++)); do
        if [ $i -le $completed ]; then
            progress_bar+="â–ˆ"
        else
            progress_bar+="â–‘"
        fi
    done
    
    printf "\rğŸ”„ $operation: [%s] %d%% (%d/%d)" "$progress_bar" "$percentage" "$current" "$total"
    
    if [ "$current" -eq "$total" ]; then
        echo ""
        echo "âœ… $operation å®Œæˆ!"
    fi
}
```

## ğŸ“‹ æ“ä½œæ£€æŸ¥æ¸…å•

### å¼€å§‹ä»»åŠ¡å‰æ£€æŸ¥
```bash
pre_task_check() {
    local task_name="$1"
    echo "ğŸ” ä»»åŠ¡å‰æ£€æŸ¥: $task_name"
    
    # ç³»ç»ŸçŠ¶æ€
    check_system_status
    
    # GitçŠ¶æ€
    check_git_status
    
    # ç¡®è®¤å½“å‰ç›®å½•
    echo "ğŸ“ å½“å‰ç›®å½•: $(pwd)"
    
    # ç¡®è®¤æ—¶é—´
    echo "â° å½“å‰æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S %Z')"
    
    # æ£€æŸ¥å¿…è¦å·¥å…·
    local required_tools=("git" "colcon" "ros2" "python3")
    for tool in "${required_tools[@]}"; do
        if command -v "$tool" > /dev/null 2>&1; then
            echo "âœ… $tool å¯ç”¨"
        else
            echo "âŒ $tool ä¸å¯ç”¨"
            return 1
        fi
    done
    
    echo "ğŸš€ å‡†å¤‡å¼€å§‹ä»»åŠ¡: $task_name"
}
```

### å®Œæˆä»»åŠ¡åæ£€æŸ¥
```bash
post_task_check() {
    local task_name="$1"
    echo "ğŸ” ä»»åŠ¡åæ£€æŸ¥: $task_name"
    
    # æ‰§è¡Œæ¸…ç†
    standard_cleanup "$task_name"
    
    # æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
    check_system_status
    
    # æäº¤æ›´æ”¹å»ºè®®
    if git diff --quiet; then
        echo "â„¹ï¸ æ²¡æœ‰éœ€è¦æäº¤çš„æ›´æ”¹"
    else
        echo "ğŸ’¡ å»ºè®®æäº¤æ›´æ”¹:"
        echo "git add -A"
        echo "git commit -m 'feat: å®Œæˆ $task_name'"
    fi
    
    echo "âœ… ä»»åŠ¡å®Œæˆ: $task_name - $(date '+%Y-%m-%d %H:%M:%S')"
}
```

## ğŸ¯ é¡¹ç›®ç‰¹å®šè§„åˆ™

### ROS2å·¥ä½œç©ºé—´ç®¡ç†
```bash
# ROS2å·¥ä½œç©ºé—´æ“ä½œæ ‡å‡†
ros2_workspace_operation() {
    local operation="$1"
    local workspace_path="$2"
    
    echo "ğŸ¤– ROS2å·¥ä½œç©ºé—´æ“ä½œ: $operation"
    
    # ç¡®ä¿åœ¨æ­£ç¡®ç›®å½•
    cd "$workspace_path"
    
    # æºç¯å¢ƒ
    source /opt/ros/foxy/setup.bash
    
    # æ‰§è¡Œæ“ä½œ
    case "$operation" in
        "build")
            colcon build --symlink-install --event-handlers console_direct+
            ;;
        "clean")
            rm -rf build/ install/ log/
            ;;
        "test")
            colcon test
            ;;
    esac
    
    # éªŒè¯ç»“æœ
    if [ -d "install" ]; then
        echo "âœ… å·¥ä½œç©ºé—´æ“ä½œæˆåŠŸ"
        source install/setup.bash
    else
        echo "âŒ å·¥ä½œç©ºé—´æ“ä½œå¤±è´¥"
        return 1
    fi
}
```

### Unitreeé›†æˆè§„åˆ™
```bash
# Unitreeç‰¹å®šæ“ä½œ
unitree_operation() {
    local operation="$1"
    
    # ç¡®ä¿ç¯å¢ƒæ­£ç¡®
    export RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
    
    # æºå¿…è¦ç¯å¢ƒ
    source /opt/ros/foxy/setup.bash
    source cyclonedds_ws/install/setup.bash
    
    echo "ğŸ• Unitreeæ“ä½œ: $operation"
    
    # æ‰§è¡Œæ“ä½œ...
}
```

---

## ğŸ“– ä½¿ç”¨è¯´æ˜

### åœ¨è„šæœ¬ä¸­é›†æˆè§„åˆ™
```bash
#!/bin/bash
# åœ¨æ¯ä¸ªè„šæœ¬å¼€å¤´æ·»åŠ 
set -e
source "$(dirname "$0")/../.cursor/rules/project_management.mdc"

# å¼€å§‹ä»»åŠ¡
pre_task_check "ä»»åŠ¡åç§°"

# æ‰§è¡Œä¸»è¦é€»è¾‘...

# ç»“æŸä»»åŠ¡
post_task_check "ä»»åŠ¡åç§°"
```

### åœ¨MCPåä½œä¸­ä½¿ç”¨
- æ¯æ¬¡ä½¿ç”¨edit_fileæˆ–run_terminal_cmdå‰è°ƒç”¨ç›¸å…³æ£€æŸ¥å‡½æ•°
- æ“ä½œå®Œæˆåç«‹å³æ‰§è¡Œæ¸…ç†
- æ‰€æœ‰æ—¶é—´ç›¸å…³æ“ä½œä½¿ç”¨æ ‡å‡†æ—¶é—´å‘½ä»¤
- å¤±è´¥æ—¶è°ƒç”¨cleanup_on_failureå‡½æ•°

### ç»´æŠ¤å»ºè®®
- æ¯æ—¥è¿è¡Œdaily_cleanup.sh
- æ¯å‘¨æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°
- æ¯æœˆè¯„ä¼°æ¸…ç†è§„åˆ™çš„æœ‰æ•ˆæ€§
- æ ¹æ®é¡¹ç›®å‘å±•è°ƒæ•´è§„åˆ™

---

## ğŸ§ª æµ‹è¯•ç›®å½•ç®¡ç†è§„èŒƒ

### æµ‹è¯•æ–‡ä»¶ç»„ç»‡
```bash
# Claudiaé¡¹ç›®æµ‹è¯•ç»“æ„ (NEW)
test/
â”œâ”€â”€ __init__.py         # PythonåŒ…åˆå§‹åŒ–
â”œâ”€â”€ README.md           # æµ‹è¯•è¯´æ˜æ–‡æ¡£  
â”œâ”€â”€ conftest.py         # pytesté…ç½®
â”œâ”€â”€ run_tests.py        # ç»Ÿä¸€æµ‹è¯•è¿è¡Œå™¨
â”œâ”€â”€ unit/               # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_*.py       # å•å…ƒæµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ integration/        # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_*.py       # é›†æˆæµ‹è¯•æ–‡ä»¶  
â”œâ”€â”€ hardware/           # ç¡¬ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_unitree_connection.py  # Unitreeæœºå™¨äººè¿æ¥æµ‹è¯•
â”‚   â””â”€â”€ test_*.py       # å…¶ä»–ç¡¬ä»¶æµ‹è¯•æ–‡ä»¶
â””â”€â”€ utils/              # æµ‹è¯•å·¥å…·
    â”œâ”€â”€ __init__.py
    â””â”€â”€ test_helpers.py # æµ‹è¯•è¾…åŠ©å‡½æ•°
```

### æµ‹è¯•è¿è¡Œæ ‡å‡†
```bash
# âœ… æ ‡å‡†æµ‹è¯•è¿è¡Œæ–¹å¼
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python3 test/run_tests.py

# è¿è¡Œç‰¹å®šç±»å‹çš„æµ‹è¯•
python3 test/run_tests.py --type hardware
python3 test/run_tests.py --type unit
python3 test/run_tests.py --type integration

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
python3 test/hardware/test_unitree_connection.py

# ä½¿ç”¨pytestï¼ˆå¦‚æœå®‰è£…ï¼‰
pytest test/ -v
pytest test/hardware/ --hardware -v
```

### æµ‹è¯•æ–‡ä»¶åˆ›å»ºè§„èŒƒ
```bash
# âœ… åˆ›å»ºæ–°æµ‹è¯•æ–‡ä»¶çš„æ ‡å‡†æµç¨‹
create_test_file() {
    local test_type="$1"    # unit/integration/hardware
    local test_name="$2"    # æµ‹è¯•åŠŸèƒ½åç§°
    local test_file="test/test_${test_name}.py"
    
    cat > "$test_file" << EOF
#!/usr/bin/env python3
"""
${test_name} æµ‹è¯•
Generated: $(date '+%Y-%m-%d %H:%M:%S')
"""

import unittest
import sys
from pathlib import Path

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
sys.path.insert(0, str(Path(__file__).parent.parent))

from test.utils.test_helpers import setup_test_environment

class Test${test_name^}(unittest.TestCase):
    
    def setUp(self):
        """æµ‹è¯•å‰å‡†å¤‡"""
        self.test_env = setup_test_environment("${test_name}")
    
    def test_${test_name}_basic(self):
        """åŸºç¡€åŠŸèƒ½æµ‹è¯•"""
        # æµ‹è¯•é€»è¾‘
        self.assertTrue(True)
    
    def tearDown(self):
        """æµ‹è¯•åæ¸…ç†"""
        self.test_env.cleanup()

if __name__ == "__main__":
    unittest.main()
EOF
    
    chmod +x "$test_file"
    echo "âœ… æµ‹è¯•æ–‡ä»¶åˆ›å»ºå®Œæˆ: $test_file"
}
```

### æµ‹è¯•æ—¥å¿—ç®¡ç†
```bash
# âœ… æµ‹è¯•æ—¥å¿—æ ‡å‡†ä½ç½®
TEST_LOG_DIR="logs/tests/$(date '+%Y%m')"
mkdir -p "$TEST_LOG_DIR"

# æµ‹è¯•è¿è¡Œæ—¶è‡ªåŠ¨è®°å½•
run_test_with_logging() {
    local test_file="$1"
    local log_file="$TEST_LOG_DIR/$(date '+%Y%m%d_%H%M%S')_$(basename "$test_file" .py).log"
    
    echo "ğŸ§ª è¿è¡Œæµ‹è¯•: $(basename "$test_file")" | tee "$log_file"
    python3 "$test_file" 2>&1 | tee -a "$log_file"
    
    local exit_code=${PIPESTATUS[0]}
    if [ $exit_code -eq 0 ]; then
        echo "âœ… æµ‹è¯•é€šè¿‡" | tee -a "$log_file"
    else
        echo "âŒ æµ‹è¯•å¤±è´¥ (é€€å‡ºç : $exit_code)" | tee -a "$log_file"
    fi
    
    return $exit_code
}
```

### æµ‹è¯•æ¸…ç†è§„èŒƒ  
```bash
# âœ… æµ‹è¯•ç›¸å…³æ¸…ç†
cleanup_test_files() {
    echo "ğŸ§¹ æ¸…ç†æµ‹è¯•ç›¸å…³æ–‡ä»¶..."
    
    # æ¸…ç†pytestç¼“å­˜
    find test/ -name ".pytest_cache" -type d -exec rm -rf {} + 2>/dev/null || true
    find test/ -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
    find test/ -name "*.pyc" -delete 2>/dev/null || true
    
    # æ¸…ç†ä¸´æ—¶æµ‹è¯•æ–‡ä»¶
    find test/ -name "claudia_test_*" -type d -exec rm -rf {} + 2>/dev/null || true
    
    # æ¸…ç†è¿‡æœŸæµ‹è¯•æ—¥å¿—ï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰
    find logs/tests/ -name "*.log" -mtime +7 -delete 2>/dev/null || true
    
    echo "âœ… æµ‹è¯•æ–‡ä»¶æ¸…ç†å®Œæˆ"
}
```

---

**æ­¤è§„åˆ™æ–‡ä»¶åº”è¢«è§†ä¸ºé¡¹ç›®å¼€å‘çš„åŸºç¡€è®¾æ–½ï¼Œæ‰€æœ‰ä»£ç ç”Ÿæˆå’Œæ–‡ä»¶æ“ä½œéƒ½åº”éµå¾ªè¿™äº›è§„èŒƒã€‚**
